<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizzer</title>
    <script src="jquery-3.6.1.js"></script>
    <script> 
        var questions;
        var example = [
            {"q":"What is 5+5?", "a":"10"},
            {"q":"What is the capital of MA?", "a":"Boston"}
        ];
        var adminMode = false;

        function save(){
            localStorage.setItem("questions", JSON.stringify(questions))
        }
        function load(){
            //localStorage.clear();
            var mode = location.hash.match(/^#?([^?]*)/)[1]
            var data = localStorage.getItem("questions");
            adminMode = mode == 'admin';

            if (data == null){
              questions = example;
              save();
            }
            else{
                questions = JSON.parse(data);
            }
            render()
        }
        function renderQuizList(){
            $("#quiz-list").empty();
            let i = 0;
            for(let item of questions){
                $("#quiz-list").append(`<li class="quiz-item"><h3>${item.q}</h3><input id="guess${i}" type="text"></li>`);
                i++;
            }
        }
        function renderQuizTable(){
            $("#quiz-table").empty();
            $("#quiz-table").append(`<tr><th class="question-col">Question</th><th class="question-col">Correct Answer</th><th></th></tr>`)
            let i = 0;
            for(let item of questions){
                $("#quiz-table").append(
                    `<tr>
                        <th class="question-col"><input id="q${i}" type="text" value="${questions[i].q}"></th>
                        <th class="question-col"><input id="a${i}" type="text" value="${questions[i].a}"></th>"
                        <th><button onclick="deleteQuizItem(${i})">Delete</button></th>
                    </tr>`
                    );
                i++;
            }
        }
        function render(){
            $("#quiz-table").empty();
            $("#quiz-list").empty();
            if(adminMode){
                renderQuizTable();
                $("#quiz-header").html("Quizzer Admin");
                $("#quiz-title").html("");
                $("#quiz-page").css("display", "none")
                $("#quiz-admin-page").css("display", "block")
                $("#mode-button").html("Quiz");
            }
            else{
                renderQuizList();
                $("#quiz-header").html("Quizzer");
                $("#quiz-title").html("Quiz");
                $("#quiz-page").css("display", "block")
                $("#quiz-admin-page").css("display", "none")
                $("#mode-button").html("Admin");
                
            }
        }
        function createQuizItem(){
            questions.push({"q":"Sample_question?", "a":"Sample_answer."});
            save();
            render();
            
        }
        function deleteQuizItem(i){
            questions.splice(i, 1)
            save();
            render();
        }
        function toggleAdminMode(){
            adminMode = !adminMode;
            render();
        }
        function submit(){
            var table = document.getElementById("quiz-table");
            var rows = table.rows;
            var data = [];
            for(let i = 0; i < rows.length; i++){
                data.push({q:$(`#q${i}`).val, a:$(`#q${i}`).val})
            }
            console.log(data);
            questions = data;
            save();
            render();
        }
        function updateViews(){
            var mode = location.hash.match(/^#?([^?]*)/)[1]
            adminMode = mode == 'admin';
            load();
        }
        function checkAnswers(){
            var answers = $("#quiz-list input");
            var headers = $("#quiz-list h3");
            let i = 0;
            
            for(let input of answers){
                
                if(input.value == questions[i].a){
                    input.style.backgroundColor = "green";
                    headers[i].style.backgroundColor = "green";
                }
                else{
                    input.style.backgroundColor = "red";
                    headers[i].style.backgroundColor = "red";
                }
                i++;
            }
        }

        $(document).ready(load);
        $(window).on('hashchange', updateViews);
    </script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         

    <style>
        .question-col, #new-item {
            width: 200px;
            height: 40px;
            background-color: beige;
            border: 1px solid black;
            border-collapse: collapse; 
        }
        .quiz-item{
            width: max-content;
        }
        #quiz-table {
            padding-left: 0.0em;
        }
        #quiz-admin-page{
            display: none;
        }
    </style>
</head>
<body>
    <h1 id="quiz-header">Quizzer</h1>
    <h2 id="quiz-title">Quiz</h2>
    <div id="quiz-page">
        <ol id="quiz-list"></ol>
        <button onclick="checkAnswers()">Check</button>
        <button onclick="console.log('needs implementation')">Reset</button>
    </div>
    <div id="quiz-admin-page">
        <table id="quiz-table"></table>
        <button onclick="createQuizItem()">Add</button>
        <button onclick="submit()">Save</button>
    </div>
    <button id="mode-button" onclick="toggleAdminMode()">Admin</button>
</body>
</html>